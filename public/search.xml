<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Vue2全家桶与微信开发(一)]]></title>
      <url>http://blog.ygxdxx.com/2017/03/06/Vue2&amp;Weixin%20Develop%20Part%20%E2%85%A0/</url>
      <content type="html"><![CDATA[<blockquote>
<p>此项目本身有一个APP了，为了方便将APP和微信端数据打通，需要用户微信和APP用户绑定。在开发的过程中单页面的模式在微信JS API的配置踩了很多坑，特别是IOS。由于本人表述能力和篇幅有限Orz，这里只介绍关键的实现步骤和代码，有些安全的地方和路由地方处理当时比较暴力没有细化，还望交流指导。</p>
</blockquote>
<h1 id="Vue2全家桶与微信开发-一"><a href="#Vue2全家桶与微信开发-一" class="headerlink" title="Vue2全家桶与微信开发(一)"></a>Vue2全家桶与微信开发(一)</h1><h2 id="阅读需知"><a href="#阅读需知" class="headerlink" title="阅读需知"></a>阅读需知</h2><ul>
<li>默认您已经了解了微信授权登陆、微信JS API配置及微信支付的整体流程<a href="https://mp.weixin.qq.com/wiki/17/c0f37d5704f0b64713d5d2c37b468d75.html" target="_blank" rel="external">微信帮助文档</a></li>
<li>Vue2.0（<a href="http://cn.vuejs.org/guide/" target="_blank" rel="external">Vue</a>、<a href="http://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">VueRouter</a>、<a href="http://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">Vuex</a>）全家桶基本知识，能熟悉70%以上的API</li>
<li><a href="https://github.com/mzabriskie/axios" target="_blank" rel="external">Axios</a>（Http请求组件）的基础知识（若不熟悉的可以看笔者的这2篇文章<a href="https://ygxdxx.coding.me/2017/02/27/axios%E5%85%A8%E6%94%BB%E7%95%A5/">axios全攻略</a>,<a href="https://ygxdxx.coding.me/2017/02/01/Vuex2%E4%B8%8EAxios%E5%BC%80%E5%8F%91/">Vuex2和Axios的配合</a>）<br>本来准备写一篇的，后来在写优化的时候发现东西比较多，还是分为2篇去写吧。第一篇主要写关于权限和微信配置方面的关键点。第二篇写关于性能和代码优化上的关键点。</li>
</ul>
<h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><ul>
<li>移动前端Vue组件库<a href="https://vux.li/#/" target="_blank" rel="external">Vux</a></li>
<li><a href="http://cn.vuejs.org/guide/" target="_blank" rel="external">Vue</a>、<a href="http://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">VueRouter</a>、<a href="http://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">Vuex</a>Vue三件套</li>
<li>路由和Vuex同步组件<a href="https://github.com/vuejs/vuex-router-sync" target="_blank" rel="external">Vuex-router-sync</a></li>
</ul>
<p><strong>VueRouter选用的是Hash模式，避免每次都需要去注册WxConfig</strong></p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>1、有些页面比如下单页面是不能分享的，在JS API内要配置该页面分享的是一个可以通过访问的页面如系统首页<br>2、该系统主要是在微信中应用的，在授权登录时，授权登陆页面会判断是否是微信内核（不得不说这节省了我一大笔开发，没有权限的时候直接往这跳就好了。简单暴力）<br>3、每个关键点都能引申很多的知识，这里篇幅有限，不在详细介绍</p>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><h2 id="技术点"><a href="#技术点" class="headerlink" title="技术点"></a>技术点</h2><ol>
<li>用户授权登陆，服务端从授权页面获取到OpenId（加密处理过的）后打开一个特定的URL（前端提供功能保存OPENID，回跳）,此页面从URL上取到URL在保存在Store中。</li>
<li>分享出去的页面最好都配授权页面登陆页面，在授权登陆页面的URL上可以配置自己需要回跳的页面，方便服务端有针对性的二次跳转。</li>
<li>接口返回状态码若为401，则表示没有权限，在Axios内跳转到登陆页面</li>
<li>若检测到系统内没有OpenId则跳转到授权登陆页面（防止有人把URL复制出去分享在微信中打开报错）</li>
</ol>
<h2 id="登陆逻辑流程图"><a href="#登陆逻辑流程图" class="headerlink" title="登陆逻辑流程图"></a>登陆逻辑流程图</h2><p><img src="http://okkula0y9.bkt.clouddn.com/wvue17_3_5.jpg" alt="此处输入图片的描述"></p>
<h1 id="关键技术点"><a href="#关键技术点" class="headerlink" title="关键技术点"></a>关键技术点</h1><h2 id="授权登陆网址"><a href="#授权登陆网址" class="headerlink" title="授权登陆网址"></a>授权登陆网址</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxf565864b6a1a358d&amp;</div><div class="line">redirect_uri=http%3a%2f%2fpeifei.xxxx.com%2fnoa%2ftoken%3fpage%3dhttp%3a%2f%2fpeifei.xxx.com/index&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=123#wechat_redirect</div></pre></td></tr></table></figure>
<p>网址需要实现的功能：</p>
<ul>
<li>获得OPENID传给前端(后端实现)</li>
<li>授权登陆后能跳转到想去的页面（后端跳转后前端路由控制）</li>
</ul>
<h2 id="从URL上获取OPENID"><a href="#从URL上获取OPENID" class="headerlink" title="从URL上获取OPENID"></a>从URL上获取OPENID</h2><p><strong>vue-router和vuex的共同作用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'../../store'</span>     <span class="comment">//从根目录中引入store</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</div><div class="line">  &#123;</div><div class="line">    <span class="attr">path</span>: <span class="string">'/'</span>, </div><div class="line">    <span class="attr">component</span>:R_INDEX,</div><div class="line">    <span class="attr">children</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'index/'</span>,</div><div class="line">        <span class="attr">redirect</span>:<span class="string">'/'</span></div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="comment">//服务端一律跳转到这个URL上</span></div><div class="line">    path: <span class="string">'/home/:id/:redirectUrl/'</span>, <span class="attr">redirect</span>: <span class="function"><span class="params">to</span> =&gt;</span> &#123;</div><div class="line">      <span class="comment">/**</span></div><div class="line">      * 通过dispatch触发保存openid的action</div><div class="line">      * 将URL上的OPENID保存到store中</div><div class="line">      */</div><div class="line">      store.dispatch(&#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'setOpenId'</span>,</div><div class="line">        <span class="attr">amount</span>: to.params.id</div><div class="line">      &#125;)</div><div class="line">      <span class="comment">//在回跳到需要来访的正确页面</span></div><div class="line">      <span class="keyword">return</span> <span class="string">`/<span class="subst">$&#123;to.params.redirectUrl&#125;</span>/`</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="接口的处理"><a href="#接口的处理" class="headerlink" title="接口的处理"></a>接口的处理</h2><p><strong>axios、vuex的使用结合</strong><br>此部分需要<code>Promise</code>和<code>Axios</code>的知识，若不熟悉请参阅笔者这2篇文章</p>
<ol>
<li><a href="https://ygxdxx.coding.me/2017/02/27/axios%E5%85%A8%E6%94%BB%E7%95%A5/">axios全攻略</a></li>
<li><a href="https://ygxdxx.coding.me/2017/02/01/Vuex2%E4%B8%8EAxios%E5%BC%80%E5%8F%91/">Vuex2和Axios的配合</a></li>
</ol>
<h3 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* </span></div><div class="line">*  1.超时处理</div><div class="line">*  2.post设置</div><div class="line">*  3.开发环境与正式环境的区别</div><div class="line">*/</div><div class="line">axios.defaults.timeout = <span class="number">5000</span></div><div class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span></div><div class="line">axios.defaults.baseURL =  (process.env.NODE_ENV == <span class="string">'development'</span> ? <span class="string">'http://192.168.1.15:8080/'</span> : <span class="string">'http://www.xxxx.com/'</span>)</div></pre></td></tr></table></figure>
<h3 id="全局请求处理"><a href="#全局请求处理" class="headerlink" title="全局请求处理"></a>全局请求处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* </span></div><div class="line">*  1.请求拦截，全局增加token</div><div class="line">*  2.post设置</div><div class="line">*/</div><div class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(config.method  === <span class="string">'post'</span> || config.method  === <span class="string">'put'</span> )&#123;</div><div class="line">    <span class="comment">//这里使用了qs这个库去序列化数据</span></div><div class="line">    config.data = qs.parse(config.data,&#123;<span class="attr">arrayFormat</span>:<span class="string">'brackets'</span>&#125;)</div><div class="line">  &#125;</div><div class="line">  <span class="comment">//全局追加openid</span></div><div class="line">  config.params = (</div><div class="line">      <span class="built_in">Object</span>.assign((config.params ? config.params : &#123;&#125;),&#123;<span class="string">"SESSION"</span>:store.state.common.openid&#125;)</div><div class="line">  )</div><div class="line">  <span class="keyword">return</span> config</div><div class="line">&#125;,(error) =&gt;&#123;</div><div class="line">  Vue.$vux.toast.show(&#123;<span class="attr">text</span>: <span class="string">'非法输入'</span>,<span class="attr">type</span>:<span class="string">'text'</span>,<span class="attr">time</span>:<span class="number">1000</span>&#125;)</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="全局接收处理"><a href="#全局接收处理" class="headerlink" title="全局接收处理"></a>全局接收处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* </span></div><div class="line">*  1.正确请求接口后，接口内返回的code若不为20000（前后端接口的规定），则表示是错误的参数</div><div class="line">*  2.若接口报错，并且报错的http状态码为401（前后端接口的规定）则表示用户没有该接口的权限，</div><div class="line">*  跳转到登陆页面</div><div class="line">*/</div><div class="line">axios.interceptors.response.use(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</div><div class="line">  <span class="keyword">if</span>(res.data.code != <span class="string">'20000'</span>)&#123;</div><div class="line">    Vue.$vux.toast.show(&#123;<span class="attr">text</span>:res.data.message,<span class="attr">type</span>:<span class="string">'text'</span>,<span class="attr">time</span>:<span class="number">1000</span>&#125;)</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;, (error) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span>(error.response)&#123;</div><div class="line">    <span class="keyword">switch</span> (error.response.status)&#123;</div><div class="line">      <span class="keyword">case</span> <span class="number">401</span>:</div><div class="line">        <span class="built_in">window</span>.location.href = <span class="string">`http://<span class="subst">$&#123;<span class="built_in">window</span>.<span class="built_in">document</span>.location.host&#125;</span>/?#/login/`</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">default</span>:</div><div class="line">        Vue.$vux.toast.show(&#123;<span class="attr">text</span>:<span class="string">'网络异常'</span>,<span class="attr">type</span>:<span class="string">'text'</span>,<span class="attr">time</span>:<span class="number">1000</span>&#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="页面合法性检查"><a href="#页面合法性检查" class="headerlink" title="页面合法性检查"></a>页面合法性检查</h2><p>因为整套环境都是由前端去控制页面路由，这里有很多地方需要我们去做权限的验证完善程序的健壮性，这对前端的考验很大。<br>虽然分享出去的页面处理比较暴力都是授权的链接，还是担心有人会复制URL出去在微信中打开所以需要做以下处理。</p>
<ol>
<li>验证是否在微信端</li>
<li>store中是否存在openid，是否授权登陆后的进来的</li>
<li>无权限操作的页面应该能返回正确的地方</li>
</ol>
<h3 id="检测是否授权登陆"><a href="#检测是否授权登陆" class="headerlink" title="检测是否授权登陆"></a>检测是否授权登陆</h3><p>我将授权登陆后的openid存在了store中，所以每次进行<strong>路由跳转</strong>的时候我只要检测store中是否存在openid若不存在则直接跳转到授权登录页面，授权登陆后服务端判断此openid是否存在，若存在则跳转到来访页面，不存在则跳转到login页面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(store.state.common.openId)&#123;</div><div class="line">    next();</div><div class="line">  &#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="built_in">window</span>.location.href=<span class="string">"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxf565864b6a1a358d&amp;redirect_uri=http%3a%2f%2fpeifei.qmant.com%2fnoa%2ftoken%3fpage%3dhttp%3a%2f%2fpeifei.qmant.com/index&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=123#wechat_redirect"</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="是否在微信端"><a href="#是否在微信端" class="headerlink" title="是否在微信端"></a>是否在微信端</h3><p>授权登陆页面会检测，若不在微信端会提示如下。<br><img src="http://okkula0y9.bkt.clouddn.com/wx_2017_3_6.jpg" alt="此处输入图片的描述"></p>
<h3 id="无权限页面"><a href="#无权限页面" class="headerlink" title="无权限页面"></a>无权限页面</h3><p>后端openid进行检测，若是无效的或者不对的openid会在请求接口的时候返回401，接口接收到401后，会跳转到登陆注册页面。</p>
<h2 id="微信支付的坑"><a href="#微信支付的坑" class="headerlink" title="微信支付的坑"></a>微信支付的坑</h2><blockquote>
<p>在遇到这个问题时困扰了好久，然后这篇博文<a href="http://blog.csdn.net/liufeng520/article/details/51354741" target="_blank" rel="external">开发单页应用(SPA)时候遇到的微信支付授权目录的坑</a>给了我指导，在此感谢作者</p>
</blockquote>
<h3 id="路由模式"><a href="#路由模式" class="headerlink" title="路由模式"></a>路由模式</h3><p>前端技术选型用的vuejs+vue-router，vue-router使用hashbang模式（使用hashbang也是为了避免微信jssdk的wx.config签名的坑）。在调用微信支付的时候(IOS)遇到提示”URL未注册”，这通常是因为没有在微信支付后台正确配置授权目录的问题，但是我遇到并不是这个。<br>我在调试的时候发现唤起微信支付时，IOS内打印日志中的URL和实际中的URL不一样安卓却是好的，我不知道是不是微信的BUG。后来在网上搜寻答案，发现是下面这个问题：</p>
<h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><p>首先把当前页面叫做<code>Current Page</code>。当我们从微信别的地方点击链接呼出微信浏览器时所落在的页面、或者点击微信浏览器的刷新按钮时所刷新的页面，我们叫做<code>Landing Page</code>。<br>举个例子，我们从任何地方点击链接进入页面A，然后依次浏览到B、C、D，那么Current Page就是D，而Landing Page是A，如果此时我们在D页面点击一下浏览器的刷新按钮，那么Landing Page就变成了D（以上均是在单页应用的环境下，即以hashbang模式通过js更改浏览器路径，直接href跳转的不算）。</p>
<p>问题来了，在iOS和安卓下呼出微信支付的时候，微信支付判断当前路径的规则分别是：</p>
<p>IOS：Landing Page<br>安卓：Current Page</p>
<p>这就意味着，在ios环境下，任何一个页面都有可能成为支付页面（因为我无法预知和控制用户在哪个页面点微信浏览器的刷新按钮，或是用户通过哪个连接从外部进入到系统）。</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">3个页面用到微信支付：</div><div class="line">http://example.com/#/cart/index</div><div class="line">http://example.com/#/order/orderlist</div><div class="line">http://example.com/#/order/orderinfo</div></pre></td></tr></table></figure>
<p>上述的3个链接根本不行啊，因为微信授权目录必须配置到最后一级目录，配置在根目录不行。</p>
<p>将所有的路由#前加了一个？，于是微信浏览器妥妥的把井号“#”后面的内容给去掉了<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">原来路由链接：</div><div class="line">http://example.com/#/cart/index</div><div class="line">现在路由链接：</div><div class="line">http://example.com/?#/cart/index</div></pre></td></tr></table></figure></p>
<p>我们只要将授权目录设置到根目录<code>http://example.com/</code>即可</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>这一篇主要介绍了开发过程中逻辑实现部分的关键点，下一篇介绍我在开发过程中性能上对网页进行优化的经验技巧。</p>
]]></content>
      
        
        <tags>
            
            <tag> 微信开发 </tag>
            
            <tag> Vue </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Axios全攻略]]></title>
      <url>http://blog.ygxdxx.com/2017/02/27/Axios%20Strategy/</url>
      <content type="html"><![CDATA[<blockquote>
<p>axios 是一个基于Promise 用于浏览器和 nodejs 的 HTTP 客户端，它本身具有以下特征：</p>
<h1 id="Axios全攻略"><a href="#Axios全攻略" class="headerlink" title="Axios全攻略"></a>Axios全攻略</h1></blockquote>
<ul>
<li>从浏览器中创建 XMLHttpRequest</li>
<li>从 node.js 发出 http 请求</li>
<li>支持 Promise API</li>
<li>拦截请求和响应</li>
<li>转换请求和响应数据</li>
<li>取消请求</li>
<li>自动转换JSON数据</li>
<li>客户端支持防止 CSRF/XSRF</li>
</ul>
<h2 id="引入方式"><a href="#引入方式" class="headerlink" title="引入方式"></a>引入方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ npm install axios</div><div class="line">$ cnpm install axios <span class="comment">/*taobao源*/</span></div><div class="line">$ bower install axios</div><div class="line">或者使用cdn：</div><div class="line">&lt;script src=<span class="string">"https:/*unpkg.com/axios/dist/axios.min.js"</span>&gt;&lt;/script&gt;</div></pre></td></tr></table></figure>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="执行-GET-请求"><a href="#执行-GET-请求" class="headerlink" title="执行 GET 请求"></a>执行 GET 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 向具有指定ID的用户发出请求 */</span></div><div class="line">axios.get(<span class="string">'/user?ID=12345'</span>)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(response);</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(error);</div><div class="line">  &#125;);</div><div class="line"><span class="comment">/* 也可以通过 params 对象传递参数*/</span></div><div class="line">axios.get(<span class="string">'/user'</span>, &#123;</div><div class="line">    <span class="attr">params</span>: &#123;</div><div class="line">      <span class="attr">ID</span>: <span class="number">12345</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(response);</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(error);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<h3 id="执行-POST-请求"><a href="#执行-POST-请求" class="headerlink" title="执行 POST 请求"></a>执行 POST 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">axios.post(<span class="string">'/user'</span>, &#123;</div><div class="line">    <span class="attr">firstName</span>: <span class="string">'Fred'</span>,</div><div class="line">    <span class="attr">lastName</span>: <span class="string">'Flintstone'</span></div><div class="line">  &#125;)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(response);</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(error);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<h3 id="执行多个并发请求"><a href="#执行多个并发请求" class="headerlink" title="执行多个并发请求"></a>执行多个并发请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserAccount</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345'</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserPermissions</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345/permissions'</span>);</div><div class="line">&#125;</div><div class="line">axios.all([getUserAccount(), getUserPermissions()])</div><div class="line">    <span class="comment">/* 两个请求现已完成  */</span></div><div class="line">  .then(axios.spread(<span class="function"><span class="keyword">function</span> (<span class="params">acct, perms</span>) </span>&#123;</div><div class="line"></div><div class="line">  &#125;)</div><div class="line">);</div></pre></td></tr></table></figure>
<h2 id="axios-API"><a href="#axios-API" class="headerlink" title="axios API"></a>axios API</h2><p>可以通过将相关配置传递给 axios 来进行请求。</p>
<h3 id="axios-config"><a href="#axios-config" class="headerlink" title="axios(config)"></a>axios(config)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 发送一个 POST 请求*/</span></div><div class="line">axios(&#123;</div><div class="line">  <span class="attr">method</span>: <span class="string">'post'</span>,</div><div class="line">  <span class="attr">url</span>: <span class="string">'/user/12345'</span>,</div><div class="line">  <span class="attr">data</span>: &#123;</div><div class="line">    <span class="attr">firstName</span>: <span class="string">'Fred'</span>,</div><div class="line">    <span class="attr">lastName</span>: <span class="string">'Flintstone'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="axios-url-config"><a href="#axios-url-config" class="headerlink" title="axios(url[, config])"></a>axios(url[, config])</h3><p>发送一个 GET 请求 (GET请求是默认请求模式)<br>axios(‘/user/12345’);</p>
<h3 id="请求方法别名"><a href="#请求方法别名" class="headerlink" title="请求方法别名"></a>请求方法别名</h3><p>为了方便起见，已经为所有支持的请求方法提供了别名。</p>
<ul>
<li>axios.request(config)</li>
<li>axios.get(url [，config])</li>
<li>axios.delete(url [，config])</li>
<li>axios.head(url [，config])</li>
<li>axios.post(url [，data [，config]])</li>
<li>axios.put(url [，data [，config]])</li>
<li>axios.patch(url [，data [，config]])</li>
</ul>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>当使用别名方法时，不需要在config中指定url，method和data属性。</p>
<h3 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h3><p>帮助函数处理并发请求。</p>
<ul>
<li>axios.all(iterable)</li>
<li>axios.spread(callback)</li>
</ul>
<h3 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h3><p>您可以使用自定义配置创建axios的新实例。</p>
<p>axios.create([config])</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> instance = axios.create(&#123;</div><div class="line">  <span class="attr">baseURL</span>: <span class="string">'https:/*some-domain.com/api/'</span>,</div><div class="line">  <span class="attr">timeout</span>: <span class="number">1000</span>,</div><div class="line">  <span class="attr">headers</span>: &#123;<span class="string">'X-Custom-Header'</span>: <span class="string">'foobar'</span>&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><p>可用的实例方法如下所示。 指定的配置将与实例配置合并。</p>
<ul>
<li>axios＃request(config)</li>
<li>axios＃get(url [，config])</li>
<li>axios＃delete(url [，config])</li>
<li>axios＃head(url [，config])</li>
<li>axios＃post(url [，data [，config]])</li>
<li>axios＃put(url [，data [，config]])</li>
<li>axios＃patch(url [，data [，config]])</li>
</ul>
<h2 id="请求配置"><a href="#请求配置" class="headerlink" title="请求配置"></a>请求配置</h2><p>这些是用于发出请求的可用配置选项。 只有url是必需的。 如果未指定方法，请求将默认为GET。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">/* `url`是将用于请求的服务器URL*/</span></div><div class="line">  url: <span class="string">'/user'</span>,</div><div class="line">  <span class="comment">/* `method`是发出请求时使用的请求方法 */</span></div><div class="line">  method: <span class="string">'get'</span>, <span class="comment">/* 默认*/</span></div><div class="line">  <span class="comment">/* `baseURL`将被添加到`url`前面，除非`url`是绝对的。*/</span></div><div class="line">  <span class="comment">/* 可以方便地为 axios 的实例设置`baseURL`，以便将相对 URL 传递给该实例的方法。*/</span></div><div class="line">  baseURL: <span class="string">'https:/*some-domain.com/api/'</span>,</div><div class="line">  <span class="comment">/* `transformRequest`允许在请求数据发送到服务器之前对其进行更改*/</span></div><div class="line">  <span class="comment">/* 这只适用于请求方法'PUT'，'POST'和'PATCH'*/</span></div><div class="line">  <span class="comment">/* 数组中的最后一个函数必须返回一个字符串，一个 ArrayBuffer或一个 Stream*/</span></div><div class="line">  transformRequest: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="comment">/* 做任何你想要的数据转换*/</span></div><div class="line">    <span class="keyword">return</span> data;</div><div class="line">  &#125;],</div><div class="line">  <span class="comment">/* `transformResponse`允许在 then / catch之前对响应数据进行更改*/</span></div><div class="line">  transformResponse: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="comment">/* Do whatever you want to transform the data*/</span></div><div class="line">    <span class="keyword">return</span> data;</div><div class="line">  &#125;],</div><div class="line">  <span class="comment">/* `headers`是要发送的自定义 headers*/</span></div><div class="line">  headers: &#123;<span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>&#125;,</div><div class="line">  <span class="comment">/* `params`是要与请求一起发送的URL参数*/</span></div><div class="line">  <span class="comment">/* 必须是纯对象或URLSearchParams对象*/</span></div><div class="line">  params: &#123;</div><div class="line">    <span class="attr">ID</span>: <span class="number">12345</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* `paramsSerializer`是一个可选的函数，负责序列化`params`*/</span></div><div class="line">  <span class="comment">/* (e.g. https:/*www.npmjs.com/package/qs, http:/*api.jquery.com/jquery.param/)*/</span></div><div class="line">  paramsSerializer: <span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> Qs.stringify(params, &#123;<span class="attr">arrayFormat</span>: <span class="string">'brackets'</span>&#125;)</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* `data`是要作为请求主体发送的数据*/</span></div><div class="line">  <span class="comment">/* 仅适用于请求方法“PUT”，“POST”和“PATCH”*/</span></div><div class="line">  <span class="comment">/* 当没有设置`transformRequest`时，必须是以下类型之一：*/</span></div><div class="line">  <span class="comment">/* - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams*/</span></div><div class="line">  <span class="comment">/* - Browser only: FormData, File, Blob*/</span></div><div class="line">  <span class="comment">/* - Node only: Stream*/</span></div><div class="line">  data: &#123;</div><div class="line">    <span class="attr">firstName</span>: <span class="string">'Fred'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* `timeout`指定请求超时之前的毫秒数。*/</span></div><div class="line">  <span class="comment">/* 如果请求的时间超过'timeout'，请求将被中止。*/</span></div><div class="line">  timeout: <span class="number">1000</span>,</div><div class="line">  <span class="comment">/* `withCredentials`指示是否跨站点访问控制请求*/</span></div><div class="line">  <span class="comment">/* should be made using credentials*/</span></div><div class="line">  withCredentials: <span class="literal">false</span>, <span class="comment">/* default*/</span></div><div class="line">  <span class="comment">/* `adapter'允许自定义处理请求，这使得测试更容易。*/</span></div><div class="line">  <span class="comment">/* 返回一个promise并提供一个有效的响应(参见[response docs](＃response-api))*/</span></div><div class="line">  adapter: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</div><div class="line">    <span class="comment">/* ... */</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* `auth'表示应该使用 HTTP 基本认证，并提供凭据。*/</span></div><div class="line">  <span class="comment">/* 这将设置一个`Authorization'头，覆盖任何现有的`Authorization'自定义头，使用`headers`设置。*/</span></div><div class="line">  auth: &#123;</div><div class="line">    <span class="attr">username</span>: <span class="string">'janedoe'</span>,</div><div class="line">    <span class="attr">password</span>: <span class="string">'s00pers3cret'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* “responseType”表示服务器将响应的数据类型*/</span></div><div class="line">  <span class="comment">/* 包括 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'</span></div><div class="line">  responseType: 'json', /* default*/</div><div class="line">  <span class="comment">/*`xsrfCookieName`是要用作 xsrf 令牌的值的cookie的名称*/</span></div><div class="line">  xsrfCookieName: <span class="string">'XSRF-TOKEN'</span>, <span class="comment">/* default*/</span></div><div class="line">  <span class="comment">/* `xsrfHeaderName`是携带xsrf令牌值的http头的名称*/</span></div><div class="line">  xsrfHeaderName: <span class="string">'X-XSRF-TOKEN'</span>, <span class="comment">/* default*/</span></div><div class="line">  <span class="comment">/* `onUploadProgress`允许处理上传的进度事件*/</span></div><div class="line">  onUploadProgress: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</div><div class="line">    <span class="comment">/* 使用本地 progress 事件做任何你想要做的*/</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* `onDownloadProgress`允许处理下载的进度事件*/</span></div><div class="line">  onDownloadProgress: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</div><div class="line">    <span class="comment">/* Do whatever you want with the native progress event*/</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* `maxContentLength`定义允许的http响应内容的最大大小*/</span></div><div class="line">  maxContentLength: <span class="number">2000</span>,</div><div class="line">  <span class="comment">/* `validateStatus`定义是否解析或拒绝给定的promise*/</span></div><div class="line">  <span class="comment">/* HTTP响应状态码。如果`validateStatus`返回`true`(或被设置为`null` promise将被解析;否则，promise将被*/</span></div><div class="line">  <span class="comment">/* 拒绝。*/</span></div><div class="line">  validateStatus: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>; <span class="comment">/* default</span></div><div class="line">  &#125;,</div><div class="line">  /* `maxRedirects`定义在node.js中要遵循的重定向的最大数量。*/</div><div class="line">  <span class="comment">/* 如果设置为0，则不会遵循重定向。*/</span></div><div class="line">  maxRedirects: <span class="number">5</span>, <span class="comment">/* 默认*/</span></div><div class="line">  <span class="comment">/* `httpAgent`和`httpsAgent`用于定义在node.js中分别执行http和https请求时使用的自定义代理。*/</span></div><div class="line">  <span class="comment">/* 允许配置类似`keepAlive`的选项，*/</span></div><div class="line">  <span class="comment">/* 默认情况下不启用。*/</span></div><div class="line">  httpAgent: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</div><div class="line">  <span class="attr">httpsAgent</span>: <span class="keyword">new</span> https.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</div><div class="line">  <span class="comment">/* 'proxy'定义代理服务器的主机名和端口*/</span></div><div class="line">  <span class="comment">/* `auth`表示HTTP Basic auth应该用于连接到代理，并提供credentials。*/</span></div><div class="line">  <span class="comment">/* 这将设置一个`Proxy-Authorization` header，覆盖任何使用`headers`设置的现有的`Proxy-Authorization` 自定义 headers。*/</span></div><div class="line">  proxy: &#123;</div><div class="line">    <span class="attr">host</span>: <span class="string">'127.0.0.1'</span>,</div><div class="line">    <span class="attr">port</span>: <span class="number">9000</span>,</div><div class="line">    <span class="attr">auth</span>: : &#123;</div><div class="line">      <span class="attr">username</span>: <span class="string">'mikeymike'</span>,</div><div class="line">      <span class="attr">password</span>: <span class="string">'rapunz3l'</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">/* “cancelToken”指定可用于取消请求的取消令牌*/</span></div><div class="line">  <span class="comment">/* (see Cancellation section below for details)*/</span></div><div class="line">  cancelToken: <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> (<span class="params">cancel</span>) </span>&#123;</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用 then 时，您将收到如下响应：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">axios.get(<span class="string">'/user/12345'</span>)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(response.data);</div><div class="line">    <span class="built_in">console</span>.log(response.status);</div><div class="line">    <span class="built_in">console</span>.log(response.statusText);</div><div class="line">    <span class="built_in">console</span>.log(response.headers);</div><div class="line">    <span class="built_in">console</span>.log(response.config);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="配置默认值"><a href="#配置默认值" class="headerlink" title="配置默认值"></a>配置默认值</h2><p>您可以指定将应用于每个请求的配置默认值。</p>
<h3 id="全局axios默认值"><a href="#全局axios默认值" class="headerlink" title="全局axios默认值"></a>全局axios默认值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">axios.defaults.baseURL = <span class="string">'https:/*api.example.com'</span>;</div><div class="line">axios.defaults.headers.common[<span class="string">'Authorization'</span>] = AUTH_TOKEN;</div><div class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded'</span>;</div></pre></td></tr></table></figure>
<h3 id="自定义实例默认值"><a href="#自定义实例默认值" class="headerlink" title="自定义实例默认值"></a>自定义实例默认值</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/*在创建实例时设置配置默认值*/</div><div class="line">var instance = axios.create(&#123;</div><div class="line">   baseURL：'https:/*api.example.com'*/</div><div class="line">&#125;);</div><div class="line"></div><div class="line"> </div><div class="line">/*在实例创建后改变默认值*/</div><div class="line">instance.defaults.headers.common ['Authorization'] = AUTH_TOKEN;</div></pre></td></tr></table></figure>
<h2 id="配置优先级顺序"><a href="#配置优先级顺序" class="headerlink" title="配置优先级顺序"></a>配置优先级顺序</h2><p>配置将与优先顺序合并。 顺序是lib / defaults.js中的库默认值，然后是实例的defaults属性，最后是请求的config参数。 后者将优先于前者。 这里有一个例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*使用库提供的配置默认值创建实例*/</span></div><div class="line"><span class="comment">/*此时，超时配置值为`0`，这是库的默认值*/</span></div><div class="line"><span class="keyword">var</span> instance = axios.create();</div><div class="line"> </div><div class="line"><span class="comment">/*覆盖库的超时默认值*/</span></div><div class="line"><span class="comment">/*现在所有请求将在超时前等待2.5秒*/</span></div><div class="line">instance.defaults.timeout = <span class="number">2500</span>;</div><div class="line"> </div><div class="line"><span class="comment">/*覆盖此请求的超时，因为它知道需要很长时间*/</span></div><div class="line">instance.get(<span class="string">'/ longRequest'</span>，&#123;</div><div class="line">   timeout：<span class="number">5000</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>你可以截取请求或响应在被 then 或者 catch 处理之前</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*添加请求拦截器*/</span></div><div class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span>(<span class="params">config</span>)</span>&#123;</div><div class="line">     <span class="comment">/*在发送请求之前做某事*/</span></div><div class="line">     <span class="keyword">return</span> config;</div><div class="line">   &#125;，<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">     <span class="comment">/*请求错误时做些事*/</span></div><div class="line">     <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">   &#125;);</div><div class="line"> </div><div class="line"><span class="comment">/*添加响应拦截器*/</span></div><div class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</div><div class="line">     <span class="comment">/*对响应数据做些事*/</span></div><div class="line">      <span class="keyword">return</span> response;</div><div class="line">   &#125;，<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">     <span class="comment">/*请求错误时做些事*/</span></div><div class="line">     <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">   &#125;);</div></pre></td></tr></table></figure>
<p>如果你以后可能需要删除拦截器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myInterceptor = axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</div><div class="line">axios.interceptors.request.eject(myInterceptor);</div></pre></td></tr></table></figure>
<p>你可以将拦截器添加到axios的自定义实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> instance = axios.create();</div><div class="line">instance.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;);</div></pre></td></tr></table></figure>
<h2 id="消除"><a href="#消除" class="headerlink" title="消除"></a>消除</h2><p>您可以使用取消令牌取消请求。</p>
<blockquote>
<p>axios cancel token API基于可取消的promise提议，目前处于阶段1。</p>
</blockquote>
<p>您可以使用CancelToken.source工厂创建一个取消令牌，如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> CancelToken = axios.CancelToken;</div><div class="line"><span class="keyword">var</span> source = CancelToken.source();</div><div class="line">axios.get(<span class="string">'/user/12345'</span>, &#123;</div><div class="line">  <span class="attr">cancelToken</span>: source.token</div><div class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">thrown</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (axios.isCancel(thrown)) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Request canceled'</span>, thrown.message);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">/* 处理错误*/</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">/*取消请求(消息参数是可选的)*/</span></div><div class="line">source.cancel(<span class="string">'操作被用户取消。'</span>);</div></pre></td></tr></table></figure></p>
<p>您还可以通过将执行器函数传递给CancelToken构造函数来创建取消令牌：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> CancelToken = axios.CancelToken;</div><div class="line"><span class="keyword">var</span> cancel;</div><div class="line"> </div><div class="line">axios.get(<span class="string">'/ user / 12345'</span>，&#123;</div><div class="line">   cancelToken：<span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">c</span>)</span>&#123;</div><div class="line">     <span class="comment">/*一个执行器函数接收一个取消函数作为参数*/</span></div><div class="line">     cancel = c;</div><div class="line">   &#125;)</div><div class="line">&#125;);</div><div class="line"><span class="comment">/* 取消请求*/</span></div><div class="line">clear();</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：您可以使用相同的取消令牌取消几个请求。</p>
</blockquote>
<h2 id="使用application-x-www-form-urlencoded格式"><a href="#使用application-x-www-form-urlencoded格式" class="headerlink" title="使用application / x-www-form-urlencoded格式"></a>使用application / x-www-form-urlencoded格式</h2><p>默认情况下，axios将JavaScript对象序列化为JSON。 要以应用程序/ x-www-form-urlencoded格式发送数据，您可以使用以下选项之一。</p>
<p>浏览器</p>
<p>在浏览器中，您可以使用URLSearchParams API，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> params = <span class="keyword">new</span> URLSearchParams();</div><div class="line">params.append(<span class="string">'param1'</span>, <span class="string">'value1'</span>);</div><div class="line">params.append(<span class="string">'param2'</span>, <span class="string">'value2'</span>);</div><div class="line">axios.post(<span class="string">'/foo'</span>, params);</div></pre></td></tr></table></figure>
<blockquote>
<p>请注意，所有浏览器都不支持URLSearchParams，但是有一个polyfill可用(确保polyfill全局环境)。<br>或者，您可以使用qs库对数据进行编码：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'qs'</span>);</div><div class="line">axios.post(<span class="string">'/foo'</span>, qs.stringify(&#123; <span class="string">'bar'</span>: <span class="number">123</span> &#125;);</div></pre></td></tr></table></figure>
<h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p>在node.js中，可以使用querystring模块，如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line">axios.post(<span class="string">'http:/*something.com/'</span>, querystring.stringify(&#123; <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;);</div></pre></td></tr></table></figure></p>
<p>你也可以使用qs库。</p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>axios 依赖本机要支持ES6 Promise实现。 如果您的环境不支持ES6 Promises，您可以使用polyfill。<br>axios包括TypeScript定义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</div><div class="line">axios.get(<span class="string">'/user?ID=12345'</span>);</div></pre></td></tr></table></figure>
<p>axios在很大程度上受到Angular提供的$http服务的启发。 最终，axios努力提供一个在Angular外使用的独立的$http-like服务。</p>
]]></content>
      
        
        <tags>
            
            <tag> axios </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Vuex2和Axios的开发]]></title>
      <url>http://blog.ygxdxx.com/2017/02/01/Vuex2&amp;Axios%20Develop/</url>
      <content type="html"><![CDATA[<blockquote>
<p>总结笔者最近在项目中使用Vuex2和Axios的总结和小技巧，方便日后查看。本人能力有限，如有错误还请大大们指正探讨😭。</p>
</blockquote>
<h1 id="Vuex2和Axios的开发"><a href="#Vuex2和Axios的开发" class="headerlink" title="Vuex2和Axios的开发"></a>Vuex2和Axios的开发</h1><h2 id="阅读前须知"><a href="#阅读前须知" class="headerlink" title="阅读前须知"></a>阅读前须知</h2><p>接上一篇的<a href="https://ygxdxx.coding.me/2017/01/29/Axios%E7%9A%84%E9%85%8D%E7%BD%AE/">Axios的配置</a>，阅读本文默认您已经掌握了Vuex2的基本语法、Axios的使用配置与方法、Promise的基本语法。（下面将放出参考链接方便大家在有不明白的地方查看）此篇主要叙述我在实际项目过程中Vuex2和Axios的组合操作。</p>
<p>参考：</p>
<ul>
<li><a href="https://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">Vue单向数据流-Vuex2</a></li>
<li><a href="https://github.com/mzabriskie/axioss://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">Ajax库-Axios</a></li>
<li><a href="http://www.jianshu.com/p/063f7e490e9aoss://vuex.vuejs.org/zh-cn/index.html" target="_blank" rel="external">Promise介绍</a></li>
</ul>
<h2 id="Vuex2中的Actions"><a href="#Vuex2中的Actions" class="headerlink" title="Vuex2中的Actions"></a>Vuex2中的Actions</h2><p>在Vuex1中actions都可以统一使用<code>dispatch</code>去触发<code>mutation</code>，那时候去异步这种数据流没什么认识。在Vuex2中规定了,同步的方法使用<code>commit</code>去提交<code>mutation</code>，异步的方法（如接口请求，完成接口请求后的操作）只能通过分发action去触发，即使用<code>dispatch</code>。</p>
<p><img src="https://vuex.vuejs.org/zh-cn/images/flow.png" alt="此处输入图片的描述"></p>
<p>这里不经吐槽2句，Vuex2的Api还是蛮人性化的，对比Redux为了用好单向数据流，不得不引入一大堆诸如<code>react-redux</code>、<code>redux-saga</code>、<code>redux-thunk</code>…，对新上手的小白来说简直是一脸蒙蔽。上面这些库所带的功能，用Vuex2都可以完成（手动骄傲），当然Vuex2也是站在这些巨人的肩膀上。</p>
<p>下面来看下<code>vuex2</code>中关于actions的API<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">类型: &#123; [type: string]: <span class="built_in">Function</span> &#125;</div><div class="line"></div><div class="line">在 store 上注册 action。处理函数接受一个 context 对象，包含以下属性：</div><div class="line"></div><div class="line">&#123;</div><div class="line">  state,     <span class="comment">// 等同于 store.state, 若在模块中则为局部状态</span></div><div class="line">  rootState, <span class="comment">// 等同于 store.state, 只存在于模块中</span></div><div class="line">  commit,    <span class="comment">// 等同于 store.commit</span></div><div class="line">  dispatch,  <span class="comment">// 等同于 store.dispatch</span></div><div class="line">  getters    <span class="comment">// 等同于 store.getters</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Axios的配置"><a href="#Axios的配置" class="headerlink" title="Axios的配置"></a>Axios的配置</h2><p>这个是我项目内Axios的配置，主要做了下面几件事情</p>
<ol>
<li>5秒的超时验证</li>
<li>POST的设置</li>
<li>统一的response封装。我通过接口传回的CODE码去判断该请求是否正确<br>如果想去看更详细的解析可以通过<a href="https://ygxdxx.coding.me/2017/01/29/Axios%E7%9A%84%E9%85%8D%E7%BD%AE/">Axios的配置</a></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'./whole'</span>    <span class="comment">//alert</span></div><div class="line"></div><div class="line">axios.defaults.timeout = <span class="number">5000</span>;</div><div class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span>;</div><div class="line">axios.defaults.baseURL = <span class="string">'http://xxx.xxx.com'</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//POST传参序列化</span></div><div class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(config.method  === <span class="string">'post'</span>)&#123;</div><div class="line">    config.data = qs.stringify(config.data);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> config;</div><div class="line">&#125;,(error) =&gt;&#123;</div><div class="line">   _.toast(<span class="string">"错误的传参"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//code状态码200判断</span></div><div class="line">axios.interceptors.response.use(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</div><div class="line">  <span class="keyword">if</span>(res.data.code != <span class="string">'200'</span>)&#123;</div><div class="line">    _.toast(res.data.msg);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;, (error) =&gt; &#123;</div><div class="line">  _.toast(<span class="string">"网络异常"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios;</div></pre></td></tr></table></figure>
<h2 id="完成一个请求操作"><a href="#完成一个请求操作" class="headerlink" title="完成一个请求操作"></a>完成一个请求操作</h2><p>下面介绍一个登陆action的操作，</p>
<ol>
<li>在接口发起请求时跳出loading</li>
<li>接口请求成功结束loading，并保存数据进入store</li>
<li>接口请求失败抛出异常，结束loading。</li>
<li>返回一个Promise对象，方便继续操作。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> login = <span class="function">(<span class="params">&#123; commit &#125;,params</span>) =&gt;</span> &#123;</div><div class="line">  _.busy();               <span class="comment">//loding开始</span></div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span> &#123; </div><div class="line">    axios(&#123;</div><div class="line">      <span class="attr">method</span>:<span class="string">'get'</span>,</div><div class="line">      <span class="attr">url</span>: <span class="string">'teacher/login'</span>,</div><div class="line">      <span class="attr">params</span>: &#123;</div><div class="line">        <span class="attr">moblie</span>:params.mobile,</div><div class="line">        <span class="attr">password</span>:params.password,</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">        commit(types.LOGIN,response.data.data); <span class="comment">//获得的数据通过mutation，存入store中</span></div><div class="line">        _.leave();  <span class="comment">//loding结束</span></div><div class="line">        resolve(response);</div><div class="line">    &#125;)</div><div class="line">    .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">      _.leave();  <span class="comment">//loding结束</span></div><div class="line">    &#125;)</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mutations = &#123;</div><div class="line">  [types.LOGIN](state, data)&#123;</div><div class="line">    state.token = data.token;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//调用action</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; mapActions,mapGetters  &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">methods</span>:&#123;</div><div class="line">    ...mapActions([<span class="string">'login'</span>]),                   <span class="comment">//注入action</span></div><div class="line">    _login()&#123;</div><div class="line">      <span class="keyword">let</span> params = &#123;</div><div class="line">        <span class="attr">mobile</span>:<span class="keyword">this</span>.mobile,</div><div class="line">        <span class="attr">pwd</span>:<span class="keyword">this</span>.password</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.login(params).</div><div class="line">      then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">          <span class="keyword">this</span>.$router.replace(<span class="string">'/main/index'</span>);          <span class="comment">//正确完成后进入主页</span></div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;                                 <span class="comment">//错误则清空密码文本框</span></div><div class="line">          <span class="comment">//可以在这里对Error进行捕获，然后根据错误类型进行相对应的处理</span></div><div class="line">          <span class="keyword">this</span>.pwd = <span class="string">''</span>;                           </div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="一点说明"><a href="#一点说明" class="headerlink" title="一点说明"></a>一点说明</h2><p>因为在Vuex2中action可以直接拿到Store的值，所以我们可以通过 <code>rootState</code>这个参数拿到根的store值，通过<code>state</code>拿到当前模块中store的值<br>都没必要在从getter里拿到值，然后通过params的方式传入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> xxx = <span class="function">(<span class="params">&#123;state,rootState,commit&#125;</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span> &#123; </div><div class="line">    axios(&#123;</div><div class="line">      <span class="attr">method</span>:<span class="string">'get'</span>,</div><div class="line">      <span class="attr">url</span>: <span class="string">'teacher/workbook/class/exercise'</span>,</div><div class="line">      <span class="attr">params</span>: &#123;</div><div class="line">        <span class="string">"token"</span>:rootState.login.token,          <span class="comment">//从store根中拿到数据</span></div><div class="line">        <span class="string">"classCode"</span>:state.code,                 <span class="comment">//从当前模块中拿到数据</span></div><div class="line">        <span class="string">"chapterId"</span>:rootState.route.params.chapterId</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">      commit(types.WORKBOOK_CLASS_EXERCISE,response.data.data)</div><div class="line">      resolve(response);</div><div class="line">    &#125;)</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样是不是更方便我们去审查action的代码？</p>
]]></content>
      
        
        <tags>
            
            <tag> Vue </tag>
            
            <tag> Vuex2 </tag>
            
            <tag> Axios </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Axios的配置]]></title>
      <url>http://blog.ygxdxx.com/2017/01/29/Axios%20Config/</url>
      <content type="html"><![CDATA[<blockquote>
<p>以前写Vue项目的时候都是使用vue-resource做为项目ajax库，在11月份的某一天尤大微博的更新表示ajax的库应该是通用的，放弃了对vue-resource的技术支持，推荐使用<a href="https://github.com/mzabriskie/axios" target="_blank" rel="external">axios</a>。</p>
</blockquote>
<h1 id="Axios的配置"><a href="#Axios的配置" class="headerlink" title="Axios的配置"></a>Axios的配置</h1><p><img src="http://upload-images.jianshu.io/upload_images/1987062-b3255d564903d3d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="此处输入图片的描述"><br>既然尤大推荐的应该有过人之处，好吧于是在新的项目上开始使用Axios,开启这段学习（踩坑）的历程。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install axios</div></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>Axios和其他的ajax库都是很类似的，提供了2种使用的方式一种是直接使用实例方法的如：<br>下面是实例的所有可用方法，方法中的config会与axios实例中的config合并。（实例可以将一些通用的config先配置好）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//axios.get</span></div><div class="line"><span class="comment">//axios.post</span></div><div class="line"></div><div class="line">axios.get(<span class="string">'/user?ID=12345'</span>)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(response);</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(error);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<h2 id="Config-配置"><a href="#Config-配置" class="headerlink" title="Config 配置"></a>Config 配置</h2><p>Axios的配置参数很多，我们来一一了解</p>
<ul>
<li>url —— 用来向服务器发送请求的url</li>
<li>method —— 请求方法，默认是GET方法</li>
<li>baseURL —— 基础URL路径，假如url不是绝对路径，如<a href="https://some-domain.com/api/v1/login?name=jack,那么向服务器发送请求的URL将会是baseURL" target="_blank" rel="external">https://some-domain.com/api/v1/login?name=jack,那么向服务器发送请求的URL将会是baseURL</a> + url。</li>
<li>transformRequest —— transformRequest方法允许在请求发送到服务器之前修改该请求，此方法只适用于PUT、POST和PATCH方法中。而且，此方法最后必须返回一个string、ArrayBuffer或者Stream。</li>
<li>transformResponse —— transformResponse方法允许在数据传递到then/catch之前修改response数据。此方法最后也要返回数据。</li>
<li>headers —— 发送自定义Headers头文件，头文件中包含了http请求的各种信息。</li>
<li>params —— params是发送请求的查询参数对象，对象中的数据会被拼接成url?param1=value1&amp;param2=value2。<br>paramsSerializer —— params参数序列化器。</li>
<li>data —— data是在发送POST、PUT或者PATCH请求的数据对象。</li>
<li>timeout —— 请求超时设置，单位为毫秒</li>
<li>withCredentials —— 表明是否有跨域请求需要用到证书</li>
<li>adapter —— adapter允许用户处理更易于测试的请求。返回一个Promise和一个有效的response</li>
<li>auth —— auth表明提供凭证用于完成http的身份验证。这将会在headers中设置一个Authorization授权信息。自定义Authorization授权要设置在headers中。</li>
<li>responseType —— 表示服务器将返回响应的数据类型，有arraybuffer、blob、document、json、text、stream这6个类型，默认是json类似数据。</li>
<li>xsrfCookieName —— 用作 xsrf token 值的 cookie 名称</li>
<li>xsrfHeaderName —— 带有 xsrf token 值 http head 名称</li>
<li>onUploadProgress —— 允许在上传过程中的做一些操作</li>
<li>onDownloadProgress —— 允许在下载过程中的做一些操作</li>
<li>maxContentLength —— 定义了接收到的response响应数据的最大长度。</li>
<li>validateStatus —— validateStatus定义了根据HTTP响应状态码决定是否接收或拒绝获取到的promise。如果 validateStatus 返回 true (或设置为 null 或 undefined ),promise将被接收;否则,promise将被拒绝。</li>
<li>maxRedirects —— maxRedirects定义了在node.js中redirect的最大值，如果设置为0，则没有redirect。</li>
<li>httpAgent —— 定义在使用http请求时的代理</li>
<li>httpsAgent —— 定义在使用https请求时的代理</li>
<li>proxy —— proxy定义代理服务器的主机名和端口，auth</li>
<li>cancelToken —— cancelToken定义一个 cancel token 用于取消请求</li>
</ul>
<h2 id="Response-返回"><a href="#Response-返回" class="headerlink" title="Response 返回"></a>Response 返回</h2><p>当我们ajax获取数据成功后会返回一个response对象，它包含了以下内容<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="comment">// 服务器返回的数据</span></div><div class="line">  data: &#123;&#125;,</div><div class="line">  <span class="comment">// HTTP状态吗</span></div><div class="line">  status: <span class="number">200</span>,</div><div class="line">  <span class="comment">// 服务器返回的消息</span></div><div class="line">  statusText: <span class="string">'OK'</span>,</div><div class="line">  <span class="comment">// 返回头</span></div><div class="line">  headers: &#123;&#125;,</div><div class="line">  <span class="comment">// 在返回我们的配置</span></div><div class="line">  config: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="统一Config配置"><a href="#统一Config配置" class="headerlink" title="统一Config配置"></a>统一Config配置</h2><p>在接口测试中，我们经常需要切换线上环境和测试环境，这里我们都可以通过Config来配置，这样我们所有的发起的请求都是通过这个基本的URL走了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">axios.defaults.timeout = <span class="number">5000</span>;</div><div class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span>;</div><div class="line">axios.defaults.baseURL = <span class="string">'http://www.xxxx.xxx/api'</span>;</div><div class="line"><span class="comment">// axios.defaults.baseURL = 'http://192.168.1.129:8383';</span></div></pre></td></tr></table></figure>
<h2 id="Interceptors-拦截器"><a href="#Interceptors-拦截器" class="headerlink" title="Interceptors 拦截器"></a>Interceptors 拦截器</h2><p>这里我必须重点介绍，在我们发起大量的请求时候，需要对请求做统一的处理那就用到它了。笔者在使用了<code>vue-resource</code>和<code>axios</code>之后亲身比较，<code>axios</code>的配置更加人性化。<br>官方的API上这样介绍</p>
<blockquote>
<p>You can intercept requests or responses before they are handled by then or catch.<br>您可以拦截请求或响应之前，他们处理的操作或者异常</p>
</blockquote>
<h3 id="request统一处理操作"><a href="#request统一处理操作" class="headerlink" title="request统一处理操作"></a>request统一处理操作</h3><p>如果是POST的请求，配置中可不能用<code>params</code>字段了，需要使用<code>data</code>字段。<br>这里有个小地方需要注意，POST的传参需要序列化，不然服务端不会正确的接收哦，会报错。所以这里我们要对request的数据进行一次序列化。这里我用了<code>qs</code>,大家需要install一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span></div><div class="line"></div><div class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span>;</div><div class="line"></div><div class="line"><span class="comment">//POST传参序列化</span></div><div class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(config.method  === <span class="string">'post'</span>)&#123;</div><div class="line">    config.data = qs.stringify(config.data);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> config;</div><div class="line">&#125;,(error) =&gt;&#123;</div><div class="line">   alert(<span class="string">"错误的传参"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="response统一处理操作"><a href="#response统一处理操作" class="headerlink" title="response统一处理操作"></a>response统一处理操作</h3><p>也就是说我们可以统一的在发起请求前，或者获得数据，对其进行统一的操作。这点非常的高效，在笔者的项目中，接口会返回一个code,就和微信API一样，code为200代表返回请求数据正确为其它时就自动跳出弹窗打印消息即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//code状态码200判断</span></div><div class="line">axios.interceptors.response.use(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</div><div class="line">  <span class="keyword">if</span>(res.data.code != <span class="string">'200'</span>)&#123;</div><div class="line">    alert(res.data.msg);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;, (error) =&gt; &#123;</div><div class="line">  alert(<span class="string">"网络异常"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如果发生这些错误了我要结束当前的Promise所以返回一个<code>Promise.reject(res)</code>，停止Promise队列下面的操作,如果有对于Promise不熟悉的童鞋请自行搜索<code>Promise</code>(这里还遇到了一个小坑最后会介绍)</p>
<h2 id="我的配置"><a href="#我的配置" class="headerlink" title="我的配置"></a>我的配置</h2><p>好了介绍了这么多介绍下我的axios配置的文件设置吧,这个文件名是<code>config/http.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> _ <span class="keyword">from</span> <span class="string">'./whole'</span></div><div class="line"></div><div class="line">axios.defaults.timeout = <span class="number">5000</span>;</div><div class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded;charset=UTF-8'</span>;</div><div class="line">axios.defaults.baseURL = <span class="string">'http://www.guinaben.com:8070'</span>;</div><div class="line"><span class="comment">// axios.defaults.baseURL = 'http://192.168.1.129:8383';</span></div><div class="line"></div><div class="line"><span class="comment">//POST传参序列化</span></div><div class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(config.method  === <span class="string">'post'</span>)&#123;</div><div class="line">    config.data = qs.stringify(config.data);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> config;</div><div class="line">&#125;,(error) =&gt;&#123;</div><div class="line">   _.toast(<span class="string">"错误的传参"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//code状态码200判断</span></div><div class="line">axios.interceptors.response.use(<span class="function">(<span class="params">res</span>) =&gt;</span>&#123;</div><div class="line">  <span class="keyword">if</span>(res.data.code != <span class="string">'200'</span>)&#123;</div><div class="line">    _.toast(res.data.msg);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> res;</div><div class="line">&#125;, (error) =&gt; &#123;</div><div class="line">  _.toast(<span class="string">"网络异常"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios;</div></pre></td></tr></table></figure></p>
<p>发起的请求<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'config/http'</span></div><div class="line"></div><div class="line">axios(&#123;</div><div class="line">  <span class="attr">method</span>:<span class="string">'get'</span>,</div><div class="line">  <span class="attr">url</span>: <span class="string">'xxxx/xxxxx'</span>,</div><div class="line">  <span class="attr">params</span>: &#123;</div><div class="line">    <span class="string">"textbook_id"</span>:id,</div><div class="line">    <span class="string">"token"</span>:token</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line">.then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">  resolve(response);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"></div><div class="line">axios(&#123;</div><div class="line">  <span class="attr">method</span>:<span class="string">'post'</span>,</div><div class="line">  <span class="attr">url</span>: <span class="string">'teacher/pwd/resetByMobile'</span>,</div><div class="line">  <span class="attr">data</span>: &#123;</div><div class="line">   <span class="string">"textbook_id"</span>:id,</div><div class="line">    <span class="string">"token"</span>:token</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line">.then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">    resolve(response);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="一定要看"><a href="#一定要看" class="headerlink" title="一定要看"></a>一定要看</h2><p>因为这里我使用的<code>Promise</code>,所以在安卓4.4.3一下的手机还是不支持Promise的，所以会报错。需要引入<code>npm install babel-polyfill</code>和<code>npm install babel-runtime</code>，在入口文件上加上即可。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">'babel-polyfill'</span></div></pre></td></tr></table></figure></p>
]]></content>
      
        
        <tags>
            
            <tag> Vue </tag>
            
            <tag> Axio </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title></title>
      <url>http://blog.ygxdxx.com/2017/01/28/Hello%20Hexo/</url>
      <content type="html"><![CDATA[<blockquote>
<p>今天鸡年的第一天，说了好久想搭建自己的博客记录开发的日常，结果一拖再拖Orz（拖延症伤不起）。今天花了一下午终于搭建完成。</p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>好的开头就是成功的一半</p>
<h2 id="使用技术"><a href="#使用技术" class="headerlink" title="使用技术"></a>使用技术</h2><p>1.Hexo<br>前端建站神器，这里不多说了。<a href="https://hexo.io/zh-cn/docs/themes.html" target="_blank" rel="external">Hexo文档</a></p>
<p>2.主题<br>当时在发现这个主题的时候是比较惊艳的，个人比较喜欢谷歌的这种风格，作者是位国人。很感谢无私的付出<br><a href="https://material.viosey.com/" target="_blank" rel="external">Material Theme</a></p>
<p>3.Coding Pages<br>本来打算使用Github Pages，有时候墙的厉害。使用<a href="https://coding.net/help/doc/pages/index.html" target="_blank" rel="external">Coding Pages</a>做为承载网站。<br>主要使用「用户 Pages」类型，在个人项目里新建一个名为 {user_name}.coding.me 的项目，然后将Hexo中生成的Public文件夹作为Git的主目录即可。</p>
<h2 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h2><p>1._config.yml 是全站的控制文件，在配置的时候，有时候稍不注意将下面代码前的空格删掉了运行就会报错。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//source前面有一个空格</span></div><div class="line">source_dir: source</div></pre></td></tr></table></figure></p>
<p>2.如果安装了新的主题，就需要到该主题下的_config.yml去配置。</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>新的一年，以此篇开始。Fighting~</p>
]]></content>
      
        
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> 博客 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
